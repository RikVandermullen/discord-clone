<div *ngIf="lastRead" class="flex flex-row max-w-[98%]">
    <div class="flex grow border-b border-red-500 ml-4 my-2 mr-2"></div>
    <div>
        <p class="text-sm font-semibold text-red-500 text-center mx-2 mt-3">
            {{ message.date_created | date : "longDate" }}
        </p>
    </div>
    <div class="flex grow border-b border-red-500 ml-2 my-2"></div>
    <div class="">
        <p
            class="text-xs font-semibold text-white text-center p-1 mt-2 bg-red-500 uppercase rounded-sm"
        >
            new
        </p>
    </div>
</div>
<div
    id="message-{{ message._id }}"
    class="message flex flex-row justify-between px-3 py-2 hover:bg-main-gray-hover2 group"
>
    <div class="flex flex-row px-3 py-1 min-w-[95%] max-w-[95%]">
        <img
            src="https://api.dicebear.com/5.x/identicon/svg?seed={{
                message.author._id
            }}"
            alt="Avatar"
            class="w-8 h-8 md:w-10 md:h-10 rounded-full hover:cursor-pointer mt-1"
        />
        <div class="flex flex-col justify-between min-w-full">
            <div class="flex flex-col ml-5">
                <div class="flex flex-row justify-between">
                    <div class="flex flex-grow">
                        <p class="m-0 p-0">
                            <span
                                class="font-semibold hover:underline hover:cursor-pointer"
                                >{{ message.author.userName }}</span
                            >
                            <span
                                class="text-gray-400 text-sm ml-2 hover:no-underline"
                                >{{ formattedDate }}</span
                            >
                        </p>
                    </div>
                    <!-- ICONS -->
                    <div
                        *ngIf="
                            !editMode && currentUser._id === message.author._id
                        "
                        class="flex flex-row gap-1"
                    >
                        <svg
                            class="hover:cursor-pointer hover:scale-110 hidden group-hover:block"
                            aria-hidden="true"
                            role="img"
                            width="24"
                            height="24"
                            viewBox="0 0 24 24"
                            (click)="editMessage()"
                        >
                            <path
                                fill-rule="evenodd"
                                clip-rule="evenodd"
                                d="M19.2929 9.8299L19.9409 9.18278C21.353 7.77064 21.353 5.47197 19.9409 4.05892C18.5287 2.64678 16.2292 2.64678 14.817 4.05892L14.1699 4.70694L19.2929 9.8299ZM12.8962 5.97688L5.18469 13.6906L10.3085 18.813L18.0201 11.0992L12.8962 5.97688ZM4.11851 20.9704L8.75906 19.8112L4.18692 15.239L3.02678 19.8796C2.95028 20.1856 3.04028 20.5105 3.26349 20.7337C3.48669 20.9569 3.8116 21.046 4.11851 20.9704Z"
                                fill="currentColor"
                            ></path>
                        </svg>

                        <svg
                            class="hover:cursor-pointer hover:scale-110 hidden group-hover:block"
                            aria-hidden="true"
                            role="img"
                            width="24"
                            height="24"
                            viewBox="0 0 24 24"
                            (click)="deleteMessage()"
                        >
                            <path
                                fill="currentColor"
                                d="M15 3.999V2H9V3.999H3V5.999H21V3.999H15Z"
                            ></path>
                            <path
                                fill="currentColor"
                                d="M5 6.99902V18.999C5 20.101 5.897 20.999 7 20.999H17C18.103 20.999 19 20.101 19 18.999V6.99902H5ZM11 17H9V11H11V17ZM15 17H13V11H15V17Z"
                            ></path>
                        </svg>
                    </div>
                </div>
            </div>
            <div *ngIf="!editMode" class="ml-5">
                <div>
                    <span
                        class="text-white-light m-0 p-0 break-normal break-all whitespace-pre-line"
                    >
                        {{ message.content }}
                    </span>
                    <p *ngIf="message.isEdited" class="text-gray-500 text-xs">
                        (edited)
                    </p>
                </div>
            </div>
            <div
                *ngIf="editMode"
                class="flex flex-col grow min-w-full max-w-full ml-5"
            >
                <div
                    id="edit-{{ message._id }}"
                    #messageId
                    [contentEditable]="true"
                    class="bg-main-gray-light text-gray-200 rounded-lg p-3 mt-2 mr-3 outline-none border-none ring-transparent focus:outline-none focus:border-none focus:ring-transparent"
                ></div>
                <div class="inline">
                    <span class="text-xs">escape to </span
                    ><span class="text-xs text-blue-400">cancel</span
                    ><span class="text-xs"> â€¢ enter to </span
                    ><span class="text-xs text-blue-400">save</span>
                </div>
            </div>
        </div>
    </div>
</div>
